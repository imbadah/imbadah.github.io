<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>PdfSwift | Ø§Ù„Ø£Ø¯ÙˆØ§Øª</title>

<!-- PDF-LIB -->
<script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Tahoma, Arial;
  background: #0f172a;
  color: #fff;
}

header {
  padding: 20px;
  text-align: center;
  font-size: 24px;
  font-weight: bold;
}

.container {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.tool {
  background: #020617;
  border-radius: 14px;
  padding: 20px;
  margin-bottom: 20px;
}

.tool h3 {
  margin-top: 0;
}

input, select, button {
  width: 100%;
  margin-top: 10px;
  padding: 12px;
  border-radius: 10px;
  border: none;
  font-size: 15px;
}

input, select {
  background: #020617;
  color: #fff;
  border: 1px solid #334155;
}

button {
  background: linear-gradient(135deg,#38bdf8,#6366f1);
  color: #fff;
  cursor: pointer;
}

button:hover {
  opacity: .9;
}

.status {
  margin-top: 10px;
  font-size: 14px;
}

.status.error {
  color: #f87171;
}

.status.success {
  color: #4ade80;
}
</style>
</head>

<body>

<header>ğŸ§© PdfSwift â€“ Ø£Ø¯ÙˆØ§Øª PDF</header>

<div class="container">

  <!-- Ø¯Ù…Ø¬ -->
  <div class="tool">
    <h3>Ø¯Ù…Ø¬ Ù…Ù„ÙØ§Øª PDF</h3>
    <input type="file" id="merge-files" multiple accept="application/pdf">
    <button id="btn-merge">Ø¯Ù…Ø¬ Ø§Ù„Ø¢Ù†</button>
    <div id="merge-status" class="status"></div>
  </div>

  <!-- ØªÙ‚Ø³ÙŠÙ… -->
  <div class="tool">
    <h3>Ø§Ø³ØªØ®Ø±Ø§Ø¬ / ØªÙ‚Ø³ÙŠÙ… ØµÙØ­Ø§Øª</h3>
    <input type="file" id="split-file" accept="application/pdf">
    <input type="text" id="split-ranges" placeholder="Ù…Ø«Ø§Ù„: 1-3,5">
    <button id="btn-split">Ø§Ø³ØªØ®Ø±Ø§Ø¬</button>
    <div id="split-status" class="status"></div>
  </div>

  <!-- ØªØ¯ÙˆÙŠØ± -->
  <div class="tool">
    <h3>ØªØ¯ÙˆÙŠØ± Ø§Ù„ØµÙØ­Ø§Øª</h3>
    <input type="file" id="rotate-file" accept="application/pdf">
    <select id="rotate-degree">
      <option value="90">90Â°</option>
      <option value="180">180Â°</option>
      <option value="270">270Â°</option>
    </select>
    <button id="btn-rotate">ØªØ¯ÙˆÙŠØ±</button>
    <div id="rotate-status" class="status"></div>
  </div>

  <!-- Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© -->
  <div class="tool">
    <h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ©</h3>
    <input type="file" id="watermark-file" accept="application/pdf">
    <input type="text" id="watermark-text" placeholder="Ø§Ù„Ù†Øµ">
    <button id="btn-watermark">Ø¥Ø¶Ø§ÙØ©</button>
    <div id="watermark-status" class="status"></div>
  </div>

</div>

<script>
const { PDFDocument, rgb, degrees, StandardFonts } = PDFLib;

function download(bytes, name) {
  const blob = new Blob([bytes], { type: "application/pdf" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = name;
  a.click();
}

function status(id, msg, type="success") {
  const el = document.getElementById(id);
  el.textContent = msg;
  el.className = "status " + type;
}

/* Ø¯Ù…Ø¬ */
document.getElementById("btn-merge").onclick = async () => {
  try {
    const files = document.getElementById("merge-files").files;
    if (!files.length) throw "Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª PDF";

    const merged = await PDFDocument.create();

    for (const f of files) {
      const pdf = await PDFDocument.load(await f.arrayBuffer());
      const pages = await merged.copyPages(pdf, pdf.getPageIndices());
      pages.forEach(p => merged.addPage(p));
    }

    download(await merged.save(), "merged.pdf");
    status("merge-status", "ØªÙ… Ø§Ù„Ø¯Ù…Ø¬ Ø¨Ù†Ø¬Ø§Ø­");
  } catch (e) {
    status("merge-status", e, "error");
  }
};

/* ØªÙ‚Ø³ÙŠÙ… */
document.getElementById("btn-split").onclick = async () => {
  try {
    const file = document.getElementById("split-file").files[0];
    const ranges = document.getElementById("split-ranges").value;
    if (!file || !ranges) throw "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„ØµÙØ­Ø§Øª";

    const src = await PDFDocument.load(await file.arrayBuffer());
    const out = await PDFDocument.create();

    ranges.split(",").forEach(r => {
      if (r.includes("-")) {
        let [s,e] = r.split("-").map(n=>parseInt(n)-1);
        for (let i=s;i<=e;i++) out.addPage(src.getPage(i));
      } else {
        out.addPage(src.getPage(parseInt(r)-1));
      }
    });

    download(await out.save(), "extracted.pdf");
    status("split-status","ØªÙ… Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬");
  } catch (e) {
    status("split-status", e, "error");
  }
};

/* ØªØ¯ÙˆÙŠØ± */
document.getElementById("btn-rotate").onclick = async () => {
  try {
    const file = document.getElementById("rotate-file").files[0];
    if (!file) throw "Ø§Ø®ØªØ± Ù…Ù„Ù";

    const pdf = await PDFDocument.load(await file.arrayBuffer());
    const deg = parseInt(document.getElementById("rotate-degree").value);

    pdf.getPages().forEach(p =>
      p.setRotation(degrees(p.getRotation().angle + deg))
    );

    download(await pdf.save(), "rotated.pdf");
    status("rotate-status","ØªÙ… Ø§Ù„ØªØ¯ÙˆÙŠØ±");
  } catch (e) {
    status("rotate-status", e, "error");
  }
};

/* Ø¹Ù„Ø§Ù…Ø© Ù…Ø§Ø¦ÙŠØ© */
document.getElementById("btn-watermark").onclick = async () => {
  try {
    const file = document.getElementById("watermark-file").files[0];
    const text = document.getElementById("watermark-text").value;
    if (!file || !text) throw "Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";

    const pdf = await PDFDocument.load(await file.arrayBuffer());
    const font = await pdf.embedFont(StandardFonts.HelveticaBold);

    pdf.getPages().forEach(p => {
      const {width,height} = p.getSize();
      p.drawText(text,{
        x: width/4,
        y: height/2,
        size: 40,
        font,
        color: rgb(.7,.7,.7),
        rotate: degrees(-45),
        opacity:.4
      });
    });

    download(await pdf.save(),"watermarked.pdf");
    status("watermark-status","ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©");
  } catch (e) {
    status("watermark-status", e, "error");
  }
};
</script>

</body>
</html>
